{% extends 'base.html.twig' %}

{% block title %} Sortir | Accueil {% endblock %}

{% block body %}

    {# ------------ SEARCH FILTERS --------------------- #}
    <h1>Filtrer les sorties</h1>

    {{ form_start(searchForm) }}

        {{ form_row(searchForm.campus) }}
        {{ form_row(searchForm.minDate) }}
        {{ form_row(searchForm.maxDate) }}
        {% if app.user %}
            {{ form_row(searchForm.filters) }}
        {% endif %}

        <button type="submit">Rechercher</button>
    {{ form_end(searchForm) }}

    {# ------------------- SORTIES TABLE ----------------------- #}
    <table>
        <thead>
            <tr>
                <th>Nom de la sortie</th>
                <th>Date de la sortie</th>
                <th>Date Limite Inscription</th>
                <th>Places Disponibles</th>
                <th>Statut</th>
                {% if app.user %} <th>Inscrit.e</th> {% endif %}
                <th>Organisateur</th>
                <th>Actions</th>
            </tr>
        </thead>

        {% for sortie in sorties %}
            <tr>
                <td>{{ sortie.nom }}</td>
                <td>{{ sortie.dateHeureDebut | date("d/m/Y H:i") }}</td>
                <td>{{ sortie.dateLimiteInscription | date("d/m/Y") }}</td>
                <td>{{ sortie.nbInscriptionsMax - sortie.users | length }} / {{ sortie.nbInscriptionsMax }}</td>
                <td>{{ sortie.etat.libelle }}</td>
                {% if app.user %}
                    <td>
                        {% if sortie in app.user.sorties %} X {% endif %}
                    </td>
                {% endif %}
                <td>{{ sortie.organisateur.username }}</td>
                <td>
                    {% if sortie.etat.libelle is not constant('App\\Entity\\Etat::DONE')
                        and sortie.etat.libelle is not constant('App\\Entity\\Etat::RUNNING')
                        and app.user and app.user.id == sortie.organisateur.id %}
                        {# @TODO ajouter le chemin pour modifier une sortie ICI #}
                        <a href="#">Modifier</a>
                    {% else %}
                        <a href="{{ path('sorties_details', {'id':sortie.id}) }}">Afficher</a>
                    {% endif %}

                    {% if app.user and app.user.id == sortie.organisateur.id %}
                        {% if sortie.etat.libelle is constant('App\\Entity\\Etat::CREATED') %}
                            {# @TODO ajouter le chemin pour publier ICI #}
                            - <a href="#">Publier</a>
                        {% elseif sortie.etat.libelle is not constant('App\\Entity\\Etat::DONE') or sortie.etat.libelle is not constant('App\\Entity\\Etat::RUNNING')%}
                            {# @TODO ajouter le chemin pour annuler une sortie ICI #}
                            - <a href="#">Annuler</a>
                        {% endif %}
                    {# @TODO ajouter le chemin pour se desinscrire ICI #}
                    {% elseif app.user and sortie in app.user.sorties %}
                        - <a href="#">Se d√©sister</a>
                    {% endif %}

                </td>
            </tr>
        {% endfor %}
    </table>

{% endblock %}